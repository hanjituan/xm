!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue"),require("dayjs"),require("echarts"),require("@vueuse/core")):"function"==typeof define&&define.amd?define(["exports","vue","dayjs","echarts","@vueuse/core"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).XMComponents={},e.Vue,e.dayjs,e.echarts,e.VueUse)}(this,function(e,t,a,n,i){"use strict";function o(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const a in e)if("default"!==a){const n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:()=>e[a]})}return t.default=e,Object.freeze(t)}const l=o(n),r={timeRange:{type:Array,default:()=>[a().subtract(1,"day"),a()]},startIcon:{type:String,default:"data:image/png;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0Ij4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNUNCMEZFIiBzdHJva2Utd2lkdGg9IjIiLz4KICA8cGF0aCBkPSJNMTUgMTJsLTYtNnYxMmw2LTZ6IiBmaWxsPSIjNUNCMEZFIi8+Cjwvc3ZnPgo="},endIcon:{type:String,default:"data:image/png;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0Ij4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNUNCMEZFIiBzdHJva2Utd2lkdGg9IjIiLz4KICA8cGF0aCBkPSJNOSAxMmw2LTZ2MTJsLTYtNnoiIGZpbGw9IiM1Q0IwRkUiLz4KPC9zdmc+Cg=="},symbolSize:{type:Number,default:20},valueData:{type:Array,default:()=>[]},activeTime:{type:Array,default:()=>[0,12]},interval:{type:Number,default:4},autoInterval:{type:Boolean,default:!0},needClick:{type:Boolean,default:!0},maxRange:{type:Number,default:168},minRange:{type:Number,default:3},coverColor:{type:String,default:"rgba(160,210,255,0.14)"},lineColor:{type:String,default:"#5CB0FE"}},s=t.defineComponent({__name:"drag-chart",props:{...r},emits:["update:activeTime","outOfRange"],setup(e,{emit:n}){const o=e,r=n,s=t.ref();let u;const m=(e=o.timeRange[0],t=o.timeRange[o.timeRange.length-1])=>a(t).diff(e,"day")+1,c=t.computed(()=>24*m()),d=t.computed(()=>{const e=[],t=a(o.timeRange[0]),n=m();for(let a=0;a<=n;a++){const n=t.add(a,"day");for(let t=0;t<24;t++)e.push(n.hour(t).format("YYYY-MM-DD HH:00:00"))}return e}),h=t.computed({get:()=>g(),set(e){r("update:activeTime",e)}}),g=()=>{if(!o.activeTime||2!==o.activeTime.length)return[[0,0],[d.value.length-1,0]];if(a(o.activeTime[0]).isBefore(a(o.timeRange[0]))||a(o.activeTime[1]).isAfter(a(o.timeRange[o.timeRange.length-1])))return r("outOfRange",{type:"activeTime",value:o.activeTime,timeRange:o.timeRange,message:"activeTime is out of timeRange"}),[[0,0],[24,0]];return[[d.value.findIndex(e=>a(e).isSame(a(o.activeTime[0]),"hour")),0],[d.value.findIndex(e=>a(e).isSame(a(o.activeTime[1]),"hour")),0]]};i.useResizeObserver(s,()=>{u&&u.resize({width:"auto",height:"auto"})});const v=t.computed(()=>Math.floor((c.value-1)/12)+1),p=t.computed(()=>{if(!o.valueData||0===o.valueData.length)return[];const e=o.valueData.reduce((e,t)=>{const n=e[e.length-1];return n&&a(n).hour()===a(t).hour()?e:[...e,a(t).set("minute",0).set("second",0).format("YYYY-MM-DD HH:mm:ss")]},[]),t=a(o.timeRange[0]),n=a(o.timeRange[o.timeRange.length-1]);return e.filter(e=>{const i=a(e);return i.isAfter(t)&&i.isBefore(n)})}),f=(e,t)=>{const a=[];for(let n=e;n<=t;n+=1)a.push([n,2]);return a},y=(e,t)=>{const a=Math.abs(t-e);if(a<o.minRange){const n=(e+t)/2,i=o.minRange/2;e=Math.max(0,n-i),(t=Math.min(c.value,n+i))-e<o.minRange?0===e?t=Math.min(c.value,o.minRange):t===c.value&&(e=Math.max(0,c.value-o.minRange)):r("outOfRange",{type:"min",currentRange:a,minRange:o.minRange})}if(a>o.maxRange){const n=(e+t)/2,i=o.maxRange/2;e=Math.max(0,n-i),t=Math.min(c.value,n+i),0===e&&t-e>o.maxRange?t=o.maxRange:t===c.value&&t-e>o.maxRange?e=c.value-o.maxRange:(console.log(`当前范围: ${a}, 最大范围: ${o.maxRange}`),r("outOfRange",{type:"max",currentRange:a,minRange:o.minRange}))}return{leftX:Math.round(e),rightX:Math.round(t)}},x=()=>{u.setOption({graphic:h.value.map(e=>({position:u.convertToPixel("grid",e)}))})},I=()=>{const e=Math.min(h.value[0][0],h.value[1][0]),t=Math.max(h.value[0][0],h.value[1][0]),a=f(e,t),n=h.value[0][0]<h.value[1][0];u.setOption({series:[{id:"a",data:h.value,z:80,silent:!0,animation:!1,symbolSize:0},{id:"lineRange",data:a,type:"line",areaStyle:{color:o.coverColor},symbolSize:0,markLine:R(a),z:90,silent:!0,animation:!1}]}),u.setOption({graphic:h.value.map((e,t)=>({position:u.convertToPixel("grid",e),type:"image",style:{image:(n?0===t:1===t)?o.startIcon:o.endIcon,width:o.symbolSize,height:o.symbolSize,x:-o.symbolSize/2,y:-o.symbolSize/2},invisible:!1,z:100}))})},M=()=>{r("update:activeTime",h.value.map(e=>d.value[e[0]]))},b=e=>{if(!e.ctrlKey&&!e.shiftKey)return;e.preventDefault();const t=e.deltaY,a=Math.abs(h.value[1][0]-h.value[0][0]);if(e.shiftKey){const e=2,n=t>0?e:-e;let i=h.value[0][0]+n,o=h.value[1][0]+n;return i<0&&(i=0,o=a),o>c.value&&(o=c.value,i=c.value-a),h.value[0]=[i,0],h.value[1]=[o,0],I(),void M()}if(a<=o.minRange&&t>0)return;if(a>=o.maxRange&&t<0)return;let n=t>0?Math.min(o.maxRange,Math.min(c.value,1.1*a)):Math.max(o.minRange,.9*a);const i=(h.value[0][0]+h.value[1][0])/2;let l=Math.round(i-n/2),r=Math.round(i+n/2);l<0&&(l=0,r=Math.min(c.value,Math.round(n))),r>c.value&&(r=c.value,l=Math.max(0,Math.round(c.value-n)));const{leftX:s,rightX:u}=y(l,r);h.value[0]=[s,0],h.value[1]=[u,0],I(),M()},w=()=>{const e=Math.min(h.value[0][0],h.value[1][0]),t=Math.max(h.value[0][0],h.value[1][0]),n=f(e,t),i=p.value.map(e=>[d.value.findIndex(t=>a(t).isSame(a(e),"hour")),1]),l=[{id:"lineRange",type:"line",data:n,areaStyle:{color:o.coverColor},lineStyle:{color:o.lineColor,width:1},symbol:"none",markLine:R(n),z:100,silent:!0,animation:!1},{id:"barData",type:"bar",data:i,barWidth:20,itemStyle:{color:"#C2E2FF",borderRadius:[3,3,0,0]},z:0,silent:!0,animation:!1}];return{tooltip:{triggerOn:"none",formatter:function(e){const t=d.value[Math.round(e.data[0])];return a(t).format("MM/DD HH:mm")}},grid:{top:"50%",left:"50",right:"50"},xAxis:{min:0,max:c.value,interval:o.autoInterval?v.value:o.interval,type:"value",boundaryGap:["0%","100%"],axisLine:{onZero:!1},axisTick:{inside:!0},splitLine:{show:!1},axisLabel:{formatter:function(e){let t=d.value[e];const n=a(t).hour();return 0==n?`{datebox|}{date|${a(t).format("MM/DD")}}`:`{time|${n}:00}`},rich:{datebox:{width:40},date:{color:"#333333",backgroundColor:"rgba(51,51,51,0.08)",padding:4,borderRadius:10},time:{color:"#666"}}}},yAxis:{type:"value",axisLine:{show:!1},axisLabel:{show:!1},axisTick:{show:!1},splitLine:{show:!1}},series:[{id:"a",type:"line",smooth:!0,data:h.value,areaStyle:{},symbolSize:0},...l]}},R=e=>({symbol:"none",animation:!1,z:0,lineStyle:{color:o.lineColor,width:1,type:"solid"},data:[[{coord:[e[0][0],0]},{coord:[e[0][0],e[0][1]]}],[{coord:[e[e.length-1][0],0]},{coord:[e[e.length-1][0],e[e.length-1][1]]}]]}),C=e=>{const t=[e.offsetX,e.offsetY],a=u.convertFromPixel({seriesIndex:0},t);if(!a||a.length<2)return;const n=Math.round(Math.min(Math.max(a[0],0),c.value)),i=Math.min(h.value[0][0],h.value[1][0]),l=Math.max(h.value[0][0],h.value[1][0]),r=Math.abs(n-i)<=Math.abs(n-l),s=h.value[0][0]<=h.value[1][0]?0:1,m=0===s?1:0;let d=i,g=l;if(r){const e=l-o.minRange,t=Math.max(0,l-o.maxRange);d=Math.max(t,Math.min(n,e))}else{const e=i+o.minRange,t=Math.min(c.value,i+o.maxRange);g=Math.min(t,Math.max(n,e))}const{leftX:v,rightX:p}=y(d,g);h.value[s]=[v,0],h.value[m]=[p,0],I(),M()},S=()=>{u.setOption({graphic:h.value.map((e,t)=>({type:"image",position:u.convertToPixel("grid",e),style:{image:0===t?o.startIcon:o.endIcon,width:o.symbolSize,height:o.symbolSize,x:-o.symbolSize/2,y:-o.symbolSize/2},invisible:!1,draggable:"horizontal",ondrag:function(e,a){((e,t)=>{const a=u.convertFromPixel("grid",t);a[0]=Math.min(Math.max(a[0],0),c.value),a[1]=h.value[e][1],h.value[e]=a,I()})(t,[this.x,this.y])},ondragend:function(){((e,t)=>{const a=u.convertFromPixel("grid",t);a[0]=Math.round(Math.min(Math.max(a[0],0),c.value)),a[1]=h.value[e][1],h.value[e]=a;const n=Math.min(h.value[0][0],h.value[1][0]),i=Math.max(h.value[0][0],h.value[1][0]),{leftX:o,rightX:l}=y(n,i),r=h.value[0][0]<=h.value[1][0]?0:1,s=0===r?1:0;h.value[r]=[o,0],h.value[s]=[l,0],I(),M()})(t,[this.x,this.y])},onmousemove:function(){(e=>{u.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:e})})(t)},onmouseout:function(){u.dispatchAction({type:"hideTip"})},z:200}))})};return t.onMounted(()=>{u=l.init(s.value,null,{renderer:"svg"}),u.setOption(w()),setTimeout(()=>{S()},0),window.addEventListener("resize",x),o.needClick&&u.getZr().on("click",C),s.value.addEventListener("wheel",b,{passive:!1})}),t.onBeforeUnmount(()=>{var e;window.removeEventListener("resize",x),u.getZr().off("click",C),null==(e=s.value)||e.removeEventListener("wheel",b)}),t.watch(()=>o.timeRange,e=>{u&&(u.setOption(w()),x())},{immediate:!0}),(e,a)=>(t.openBlock(),t.createElementBlock("div",{ref_key:"chartRef",ref:s,style:{"min-width":"100px","min-height":"10px",height:"100%",width:"100%"},class:"chart-wrap"},null,512))}}),u=[s],m={install:e=>{u.forEach(t=>{e.component(t.name||t.__name||"DragChart",t)})}},c=(e,t)=>{const a=e.__vccOpts||e;for(const[n,i]of t)a[n]=i;return a},d={name:"swiper-simple",data:()=>({offset:0,swiperContainer:null,scrollIndex:0,timer:null,imgs:[]}),props:{...{imgList:{type:Array,default:()=>[],required:!0},autoPlay:{type:Boolean,default:()=>!1},playTime:{type:[String,Number],default:()=>2},keysControl:{type:Boolean,default:()=>!0},infinite:{type:Boolean,default:()=>!1}}},mounted(){this.$nextTick(()=>{this.imgs=[...this.imgList],this.swiperContainer=document.querySelector(".swiper-container"),this.keysControl&&window.addEventListener("keydown",this.keydown),this.autoPlay?this.play():this.stop()})},destroyed(){window.removeEventListener("keydown",this.keydown)},methods:{start(){},pauze(){},play(){this.timer=setInterval(()=>{this.nextPage(!0)},1e3*this.playTime)},stop(){this.timer&&this.clearInterval(this.timer)},keydown(e){this.swiperContainer?(39===e.keyCode&&this.nextPage(),37===e.keyCode&&this.prevPage()):console.warn("please keep sure that dom is loaded")},nextPage(){this.scrollIndex++,this.scrollIndex>this.imgs.length-1?this.infinite?(this.imgs=this.imgs.concat(this.imgs),this.$nextTick(()=>{this.nextFn()})):this.scrollIndex=this.imgs.length-1:this.nextFn()},nextFn(){this.offset=-400*this.scrollIndex,this.swiperContainer.style.transform=`translateX(${this.offset}px)`,this.scrollIntoViews()},prevPage(){this.scrollIndex--,this.scrollIndex<0?this.scrollIndex=0:(this.offset=-400*this.scrollIndex,this.swiperContainer.style.transform=`translateX(${this.offset}px)`,this.scrollIntoViews())},jumpByIndex(e){this.scrollIndex=e+1,this.prevPage(),this.scrollIntoViews()},scrollIntoViews(){const e=[...document.querySelector(".pagenation").childNodes][this.scrollIndex];e&&e.scrollIntoView({behavior:"smooth"})}}},h={class:"swiper-wrapper"},g={class:"swiper-container",ref:"con"},v=["src"],p={class:"pagenation"},f=["src","onClick"],y={class:"btn"};const x=c(d,[["render",function(e,a,n,i,o,l){return t.openBlock(),t.createElementBlock("div",h,[t.createElementVNode("div",g,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(o.imgs,(e,a)=>(t.openBlock(),t.createElementBlock("div",{class:"swiper-item",key:a},[t.createElementVNode("img",{src:e,alt:""},null,8,v)]))),128))],512),t.createElementVNode("div",p,[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(o.imgs,(e,a)=>(t.openBlock(),t.createElementBlock("div",{class:"page-item",key:a},[t.createElementVNode("img",{src:e,class:t.normalizeClass({active:o.scrollIndex==a}),onClick:e=>l.jumpByIndex(a),alt:""},null,10,f)]))),128))]),t.createElementVNode("div",y,[t.renderSlot(e.$slots,"leftBtn",{},()=>[t.createElementVNode("button",{class:"btn-left",onClick:a[0]||(a[0]=(...e)=>l.prevPage&&l.prevPage(...e))},"←")],!0),t.renderSlot(e.$slots,"rightBtn",{},()=>[t.createElementVNode("button",{class:"btn-right",onClick:a[1]||(a[1]=(...e)=>l.nextPage&&l.nextPage(...e))},"→")],!0)])])}],["__scopeId","data-v-bcf19a6c"]]),I=[x],M=[m,{install:e=>{I.forEach(t=>{e.component(t.name||t.__name||"SwiperSimple",t)})}}],b=e=>{M.forEach(t=>{e.use(t)})},w={install:b,version:"0.1.0"};e.DragChart=s,e.SwiperSimple=x,e.default=w,e.install=b,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=index.umd.js.map
